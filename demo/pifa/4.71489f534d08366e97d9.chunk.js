webpackJsonp([4],{113:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(4);a.n(i),e.default={data:function(){return{selected:{id:0},file:[],pagination:{page:1,pageCount:0,pageSize:0,rowCount:0},showModal:!1}},props:{show:{default:!1},fileUrl:{default:"/home/file/index"}},watch:{show:function(t,e){this.showModal=t,this.selected={id:0},this.showModal&&this.search()}},created:function(){},methods:{selectImage:function(t){if(t.id==this.selected.id)return void(this.selected={id:0});this.selected=t},cancelImage:function(){this.$emit("on-cancel",!0)},selectedImage:function(){this.$emit("on-selected",this.selected)},changePage:function(t){this.pagination.page=t,this.search()},search:function(){var t=this;this.fetch(this.fileUrl+"?page="+this.pagination.page).then(function(e){e&&e.data.data&&(t.file=e.data.data.data,t.pagination=e.data.data.pagination)})},handleAddSuccess:function(t,e){this.search()}}}},117:function(t,e){},118:function(t,e,a){t.exports=a.p+"0be0cab9f6b393db2ed5fd113175edaa.jpg"},119:function(t,e,a){a(117);var i=a(6)(a(113),a(120),null,null);i.options.__file="/Users/yaojiasong/YJSON/boke/vue/pingful-pifa-www/src/components/uploader.vue",i.esModule&&Object.keys(i.esModule).some(function(t){return"default"!==t&&"__esModule"!==t}),i.options.functional,t.exports=i.exports},120:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Modal",{attrs:{title:"图片上传管理器",closable:!0,"mask-closable":!1},on:{"on-ok":t.selectedImage,"on-cancel":t.cancelImage},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("Row",[a("Col",{attrs:{span:"6"}},[a("Upload",{attrs:{action:t.getUrl("/home/file/add"),"on-success":t.handleAddSuccess,format:["jpg","jpeg","png"],multiple:"",type:"drag","max-size":2048,"show-upload-list":!1,"on-format-error":t.handleFormatError,"on-exceeded-size":t.handleMaxSize,headers:t.uploadHeaders()}},[a("div",{staticStyle:{padding:"20px 0"}},[a("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),t._v(" "),a("p",[t._v("点击或将文件拖拽到这里上传")])],1)])],1)],1),t._v(" "),a("hr",{staticStyle:{"margin-top":"20px","border-top":"1px solid #e3e8ee","border-bottom":"0"}}),t._v(" "),a("Row",{staticStyle:{"margin-top":"20px"}},t._l(t.file,function(e,i){return a("Col",{key:i,staticStyle:{"text-align":"center",float:"left"},attrs:{span:4}},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.getFile(e),expression:"getFile(item)"}],staticStyle:{width:"120px",height:"120px",border:"1px solid #e3e8ee",padding:"3px","border-radius":"3px"},on:{click:function(a){t.selectImage(e)}}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.selected.id==e.id,expression:"selected.id == item.id"}],staticStyle:{"line-height":"128px",position:"absolute",bottom:"0",left:"0",right:"0",background:"rgba(0,0,0,.6)",cursor:"pointer","font-size":"16px"},on:{click:function(a){t.selectImage(e)}}},[a("Icon",{attrs:{type:"checkmark-circled",size:"20",color:"#fff"}}),t._v(" "),a("span",{staticStyle:{color:"#fff"}},[t._v("已选择")])],1)])})),t._v(" "),a("Row",[[a("Page",{staticStyle:{float:"right",margin:"10px"},attrs:{total:t.pagination.rowCount,current:t.pagination.page,"show-elevator":"","page-size":t.pagination.pageSize},on:{"on-change":t.changePage}})]],2)],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},277:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(1),o=a(4),n=a.n(o),l=a(119),s=a.n(l);i.default.component("item",{template:'\n    <li style="\n        line-height: 58px;\n        padding-left: 10px ;\n        border-bottom: 1px solid #eee ;">\n        <div>\n            <span @click="toggle" style="cursor: pointer;">\n                <Icon type="ios-paper-outline" size="16"></Icon>\n                <span  style="margin-left:10px;line-height:20px;">\n                    {{model.name}}\n                </span>\n                <span v-if="isFolder">[{{open ? \' - \' : \' + \'}}]</span>\n            </span>\n            <div style="float:right;margin-right:20px;cursor: pointer;">\n                <Button type="primary" size="small" style="text-align:center;" @click="changeType(\'edit\',model)">\n                    <Icon type="android-create" size="20"></Icon>\n                </Button>\n                <i-switch :value="model.status == 1" @on-change="changeType(model.status,model)"></i-switch>\n            </div>\n        </div>\n        <ul v-show="open" style="margin-left:20px;">\n          <item\n            v-if="isFolder" \n            v-for="model in model.child"\n            :key="model.id"\n            :model="model">\n          </item>\n          <li v-if="model.plv < 3">\n            <Button class="add" @click="addChild">新增子分类+</Button>        \n          </li>\n        </ul>\n     </li>\n  ',props:{model:Object},data:function(){return{open:!1,isChange:!1}},computed:{isFolder:function(){return this.model.plv<3},thatLevel:function(){return this.model.plv}},methods:{toggle:function(){this.model.plv>=3||(this.open=!this.open)},changeType:function(t,e){function a(t){var e=this;this.fetch("/home/menu/add",{status:t.status,id:t.id}).then(function(a){1==a.data.code&&a.data.data&&(1==t.status?e.$Message.success("打开菜单"+t.name):e.$Message.error("关闭菜单"+t.name))})}"edit"==t?this.$root.eventHub.$emit("update-memu",this):(e.status=t?0:1,a.call(this,e),this.$root.eventHub.$emit("update-model",e))},addChild:function(t){this.$root.eventHub.$emit("child-tell-me",this)}}}),e.default={data:function(){return{treeData:[],formData:{name:"",imgUrl:"",imgId:"",rank:"",id:""},dialog:{isOpen:!1,title:"",loading:!0,target:null,targetMsg:null},uploadPic:{isShow:!1,fileUrl:""},ruleInline:{name:[{required:!0,message:"请输入分类菜单名称",trigger:"blur"}]},updateModel:null}},components:{Uploader:s.a},watch:{treeData:{deep:!0,handler:function(t){function e(t,a){if(t.child)for(var i=t.child,o=0;o<i.length;o++)i[o].status=a,i[o].child&&i[o].child.length>0&&e(i[o],a)}function a(t){this.fetch("/home/menu/add",{status:t.status,id:t.id}).then(function(t){1==t.data.code&&t.data.data})}var i=this.updateModel;if(i){var o=i.plv,n=i.pid,l=i.status;if(1==o)return void e(i,l);if(2==o){for(var s=null,d=0;d<t.length;d++)n==t[d].id&&(s=t[d]);s.child.some(function(t){return 1==t.status})?s.status=1:(s.status=0,a.call(this,s)),e(i,l)}if(3==o){for(var r=void 0,c=void 0,u=0;u<t.length;u++)for(var h=0;h<t[u].child.length;h++)t[u].child[h].id==n&&(r=t[u].child[h],c=t[u]);r.child.some(function(t){return 1==t.status})?r.status=1:(r.status=0,a.call(this,r)),c.child.some(function(t){return 1==t.status})?c.status=1:(c.status=0,a.call(this,c))}}}}},created:function(){var t=this;this.getTreeData(),this.$root.eventHub.$on("child-tell-me",function(e){t.listenToMyBoy(e)}),this.$root.eventHub.$on("update-memu",function(e){t.updateChildData(e)}),this.$root.eventHub.$on("update-model",function(e){t.updateModel=e}),this.$bus.emit("updateMainMenuTitle","批发菜单"),this.$bus.emit("updateMainMenuActive","1-1")},methods:{addSku:function(){this.dialog.isOpen=!0,this.dialog.title="新增大分类",this.dialog.target="father",this.formData={name:"",imgUrl:"",imgId:"",rank:"",id:""}},getTreeData:function(){var t=this;this.fetch("home/menu/index").then(function(e){if(1==e.data.code&&e.data.data){for(var a=e.data.data,i=0;i<a.length;i++)a[i].child||(a[i].child=[]);t.treeData=a}})},listenToMyBoy:function(t){this.dialog.isOpen=!0,this.dialog.title="新增子分类",this.dialog.target="child",this.dialog.targetMsg=t,this.formData={name:"",imgUrl:"",imgId:"",rank:"",id:""}},updateChildData:function(t){var e=t.model;this.dialog.isOpen=!0,this.dialog.title="修改子分类",this.dialog.targetMsg=t,this.dialog.target="child",this.formData.name=e.name,this.formData.imgId=e.file_id,this.formData.imgUrl=this.getFile(e.file),this.formData.rank=e.rank,this.formData.id=e.id},ajaxData:function(t,e){var a=this,i=this.formData,o="",n=this.formData.id,l="",s=void 0,d={name:i.name,file_id:i.imgId,rank:i.rank};n?(o=e.model.pid,l=e.model.plv,s=e.model.status,d.id=n):(o=e?e.model.id:0,l=e?e.model.plv+1:1,s=1),d.status=s,d.pid=o,d.plv=l,this.$refs[t].validate(function(t){t?a.fetch("/home/menu/add",d).then(function(t){if(1==t.data.code&&t.data.data){var i=t.data.data;e?(3!=i.plv&&(i.child=[]),""==n?e.model.child.push(i):e.model.name=i.name):(i.child=[],a.treeData.push(i)),a.dialog.isOpen=!1,a.getTreeData()}else a.dialog.loading=!1,setTimeout(function(){a.dialog.loading=!0},1500);a.formData.name="",a.formData.rank="",a.formData.imgUrl="",a.formData.imgId="",a.formData.id=""}):(a.$Message.error("表单验证失败，请输入必填项"),a.dialog.loading=!1,setTimeout(function(){a.dialog.loading=!0},1500))})},ok:function(t){var e=this.dialog.target,a=this.dialog.targetMsg;"father"==e?this.ajaxData(t):this.ajaxData(t,a)},cancel:function(){this.dialog.isOpen=!1,this.formData={name:"",imgUrl:"",imgId:"",rank:"",id:""}},handleSuccess:function(t){t.id>0?(this.formData.imgUrl=this.getFile(t),this.formData.imgId=t.id):this.$Notice.open({title:"请选择图片"}),this.uploadPic.isShow=!1,this.dialog.isOpen=!0},cancelUpload:function(){this.uploadPic.isShow=!1},handleDel:function(){this.formData.imgUrl="",this.formData.imgId=""},uploadImg:function(){this.uploadPic.isShow=!0,this.dialog.isOpen=!1,this.uploadPic.fileUrl=n.a.defaults.baseURL+"/home/file/index"}}}},555:function(t,e){},579:function(t,e,a){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Row",[i("Col",[i("Modal",{attrs:{title:t.dialog.title,loading:t.dialog.loading},on:{"on-ok":function(e){t.ok("formItem")},"on-cancel":t.cancel},model:{value:t.dialog.isOpen,callback:function(e){t.dialog.isOpen=e},expression:"dialog.isOpen"}},[i("Form",{ref:"formItem",attrs:{model:t.formData,"label-width":100,rules:t.ruleInline}},[i("Form-item",{staticClass:"form-item",attrs:{label:"分类名称：",prop:"name"}},[i("Input",{attrs:{placeholder:"请输入分类名称（必填）"},model:{value:t.formData.name,callback:function(e){t.formData.name=e},expression:"formData.name"}})],1),t._v(" "),i("Form-item",{staticClass:"form-item",attrs:{label:"图片："}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.formData.imgUrl,expression:"formData.imgUrl"}],staticClass:"demo-upload-list",staticStyle:{display:"inline-block"}},[[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.formData.imgUrl,expression:"formData.imgUrl"}]}),t._v(" "),i("div",{staticClass:"demo-upload-list-cover"},[i("Icon",{attrs:{type:"ios-trash"},nativeOn:{click:function(e){t.handleDel()}}})],1)]],2),t._v(" "),i("div",{staticStyle:{display:"inline-block"},on:{click:t.uploadImg}},[i("img",{attrs:{src:a(118)}})]),t._v(" "),i("Uploader",{attrs:{show:t.uploadPic.isShow,fileUrl:t.uploadPic.fileUrl},on:{"on-selected":t.handleSuccess,"on-cancel":t.cancelUpload}})],1),t._v(" "),i("Form-item",{staticClass:"form-item",attrs:{label:"排序号："}},[i("Input",{attrs:{placeholder:"请输入排序号（必填）"},model:{value:t.formData.rank,callback:function(e){t.formData.rank=e},expression:"formData.rank"}})],1)],1)],1)],1)],1),t._v(" "),i("Row",[i("Col",{staticClass:"col",staticStyle:{"line-height":"58px",height:"58px","padding-left":"10px","border-bottom":"1px solid #eee"}},[i("Icon",{staticStyle:{"margin-right":"10px"},attrs:{type:"document-text",size:"18"}}),t._v(" "),i("span",{staticStyle:{"font-size":"16px"}},[t._v("全部分类")])],1),t._v(" "),i("Col",{staticClass:"col"},[i("div",{staticStyle:{"line-height":"58px",height:"58px","padding-left":"30px"}},[i("Icon",{staticStyle:{"margin-right":"10px"},attrs:{type:"ios-list-outline",size:"16"}}),t._v(" "),i("span",{staticStyle:{"font-size":"14px"}},[t._v("默认分类")])],1)]),t._v(" "),i("Col",[i("ul",{attrs:{id:"sku_table"}},t._l(t.treeData,function(t){return i("item",{key:t.id,attrs:{model:t}})}))]),t._v(" "),i("Col",{staticClass:"skuHeader"},[i("Button",{on:{click:t.addSku}},[t._v("新增大分类")])],1)],1)],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},81:function(t,e,a){a(555);var i=a(6)(a(277),a(579),"data-v-1b4efba2",null);i.options.__file="/Users/yaojiasong/YJSON/boke/vue/pingful-pifa-www/src/pages/home/shop/menu.vue",i.esModule&&Object.keys(i.esModule).some(function(t){return"default"!==t&&"__esModule"!==t}),i.options.functional,t.exports=i.exports}});